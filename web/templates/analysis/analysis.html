{% extends "base.html" %}

{% block title %}{{ _('Resultados') }} - IRIS{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <!-- Left Column - Analysis Tools -->
        <div class="col-md-4">
            <!-- Analysis Tools Panel -->
            <div class="analysis-tools-panel tools-panel-minimal">
                <div class="panel-header-minimal">
                    <h6 class="panel-title-minimal">
                        <i class="fas fa-tools me-2"></i>
                        {{ _('Herramientas de Análisis') }}
                    </h6>
                </div>
                
                <!-- Model Info Minimal -->
                <div class="model-info-minimal">
                    <span class="model-label">{{ _('Modelo') }}:</span>
                    <span class="model-value" id="selected-model">{{ data.model }}</span>
                </div>
                
                <!-- Action Buttons Minimal -->
                <div class="action-buttons-minimal">
                    <button class="btn-minimal btn-export" onclick="generatePDF()">
                        <i class="fas fa-file-pdf me-2"></i>
                        {{ _('PDF') }}
                    </button>
                    <button class="btn-minimal btn-export" onclick="generateWord()">
                        <i class="fas fa-file-word me-2"></i>
                        {{ _('Word') }}
                    </button>
                    <button class="btn-minimal btn-edit-mode" onclick="editAnalysis()">
                        <i class="fas fa-edit me-2"></i>
                        {{ _('Editar Análisis') }}
                    </button>
                    <button class="btn-minimal btn-save" onclick="saveAnalysisToDatabase()" id="save-analysis-btn" style="display: none;">
                        <i class="fas fa-save me-2"></i>
                        {{ _('Guardar') }}
                    </button>
                    <button class="btn-minimal btn-finish" onclick="finishAnalysis()">
                        <i class="fas fa-check me-2"></i>
                        {{ _('Finalizar') }}
                    </button>
                </div>
            </div>

            <!-- Inclusivity Score -->
            <div class="analysis-tools-panel">
                <h5 class="panel-title">
                    <i class="fas fa-chart-line me-2"></i>
                    {{ _('Puntuación de Inclusividad') }}
                </h5>
                
                <div class="score-value">{{ data.analysis.original.inclusivity_score }}%</div>
                <div class="score-bar">
                    <div class="fill" style="width: {{ data.analysis.original.inclusivity_score }}%"></div>
                </div>
                
                <div class="metrics">
                    <div class="metric">
                        <span class="label">{{ _('Contenido General') }}</span>
                        <span class="value">{{ data.analysis.original.contenido_general_score }}%</span>
                    </div>
                    <div class="metric">
                        <span class="label">{{ _('Lenguaje') }}</span>
                        <span class="value">{{ data.analysis.original.lenguaje_score }}%</span>
                    </div>
                    <div class="metric">
                        <span class="label">{{ _('Fuentes') }}</span>
                        <span class="value">{{ data.analysis.original.fuentes_score }}%</span>
                    </div>
                </div>
            </div>

            <!-- Contenido General -->
            <div class="analysis-tools-panel">
                <div class="collapsible-header" data-target="contenido-content">
                    <h5 class="panel-title mb-0">
                        <i class="fas fa-newspaper me-2"></i>
                        {{ _('Contenido General') }}
                    </h5>
                    <i class="fas fa-chevron-down toggle-icon"></i>
                </div>
                <div id="contenido-content" class="collapsible-content">
                    <div id="contenido-variables" class="variables-grid">
                        <!-- Variables will be rendered by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Lenguaje y Análisis del discurso -->
            <div class="analysis-tools-panel">
                <div class="collapsible-header" data-target="lenguaje-content">
                    <h5 class="panel-title mb-0">
                        <i class="fas fa-language me-2"></i>
                        {{ _('Lenguaje y Análisis del discurso') }}
                    </h5>
                    <i class="fas fa-chevron-down toggle-icon"></i>
                </div>
                <div id="lenguaje-content" class="collapsible-content">
                    <div id="lenguaje-variables" class="variables-grid">
                        <!-- Variables will be rendered by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Fuentes de información -->
            <div class="analysis-tools-panel">
                <div class="collapsible-header" data-target="fuentes-content">
                    <h5 class="panel-title mb-0">
                        <i class="fas fa-users me-2"></i>
                        {{ _('Fuentes de información') }}
                    </h5>
                    <i class="fas fa-chevron-down toggle-icon"></i>
                </div>
                <div id="fuentes-content" class="collapsible-content">
                    <div id="fuentes-sources" class="sources-grid">
                        <!-- Sources will be rendered by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Recomendaciones -->
            <div class="analysis-tools-panel">
                <div class="collapsible-header" data-target="recomendaciones-content">
                    <h5 class="panel-title mb-0">
                        <i class="fas fa-lightbulb me-2"></i>
                        {{ _('Recomendaciones') }}
                    </h5>
                    <i class="fas fa-chevron-down toggle-icon"></i>
                </div>
                <div id="recomendaciones-content" class="collapsible-content">
                    <ul class="list-unstyled">
                        {% for recommendation in data.analysis.original.recommendations %}
                        <li>{{ recommendation }}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>

        <!-- Right Column - Text Analysis -->
        <div class="col-md-8">
            <div class="text-analysis-panel">
                <h5 class="panel-title">
                    <i class="fas fa-file-alt me-2"></i>
                    {{ _('Análisis del Texto') }}
                </h5>
                
                <!-- Plain Text -->
                <div class="plain-text">
                    <h4>{{ data.title }}</h4>
                    <p class="text-muted mb-3">{{ data.authors }}</p>
                    <div class="analysis-text">{{ data.text | safe }}</div>
                </div>
                
                <!-- Highlighted Text -->
                <div class="highlight-text" style="display: none;">
                    <!-- Contenido General Highlights -->
                    <div id="highlight-contenido" class="highlight-block highlight-contenido" style="display: none;">
                        <h6 class="mb-3">{{ _('Contenido General') }}</h6>
                        <div class="markup-area">{{ data.highlight.original.contenido_general | safe }}</div>
                    </div>
                    
                    <!-- Lenguaje Highlights -->
                    <div id="highlight-lenguaje" class="highlight-block highlight-lenguaje" style="display: none;">
                        <h6 class="mb-3">{{ _('Lenguaje y Análisis del discurso') }}</h6>
                        <div class="markup-area">{{ data.highlight.original.lenguaje | safe }}</div>
                    </div>
                    
                    <!-- Fuentes Highlights -->
                    <div id="highlight-fuentes" class="highlight-block highlight-fuentes" style="display: none;">
                        <h6 class="mb-3">{{ _('Fuentes de información') }}</h6>
                        <div class="markup-area">{{ data.highlight.original.fuentes | safe }}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Highlight tooltip -->
<div id="highlight-tooltip" class="highlight-tooltip">
    <div class="tooltip-title"></div>
    <div class="tooltip-description"></div>
</div>

<script>
    window.data = {{ data | tojson | safe }};
    window.highlight_color_map = {{ highlight_map | safe }};
    window.api_url_edit = {{ api_url_edit | tojson | safe }};
    window.api_url_save_annotations = {{ api_url_save_annotations | tojson | safe }};
</script>

<!-- External Scripts -->
<script type="module" src="{{ url_for('static', filename='js/accordion.js') }}"></script>
<script type="module" src="{{ url_for('static', filename='js/highlight_prediction.js') }}"></script>
<script type="module" src="{{ url_for('static', filename='js/highlight_tooltip.js') }}"></script>
<script type="module" src="{{ url_for('static', filename='js/highlight_human.js') }}"></script>
<script src="{{ url_for('static', filename='js/analysis.js') }}"></script>

<link rel="stylesheet" href="{{ url_for('static', filename='css/analysis.css') }}">

{% endblock %}
