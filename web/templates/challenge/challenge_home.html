{% extends "challenge/challenge_base.html" %}

{% block title %}{{ _('Desafío de Análisis IRIS - Semana de la Ciencia') }}{% endblock %}

{% block challenge_content %}
<div class="container-fluid py-4">

    <!-- Instrucciones -->
    <div class="row mb-5">
        <div class="col-lg-8 mx-auto">
            <div class="card border-0 shadow-sm">
                <div class="card-body p-4">
                    <h3 class="card-title text-center mb-4">
                        <i class="fas fa-info-circle text-info me-2"></i>
                        {{ _('¿Cómo funciona el desafío?') }}
                    </h3>
                    <div class="row">
                        <div class="col-md-4 text-center mb-3">
                            <div class="step-icon">
                                <i class="fas fa-mouse-pointer fa-2x text-primary mb-2"></i>
                                <h5>{{ _('1. Selecciona un texto') }}</h5>
                                <p class="text-muted small">{{ _('Elige uno de los 10 textos disponibles') }}</p>
                            </div>
                        </div>
                        <div class="col-md-4 text-center mb-3">
                            <div class="step-icon">
                                <i class="fas fa-edit fa-2x text-success mb-2"></i>
                                <h5>{{ _('2. Analiza manualmente') }}</h5>
                                <p class="text-muted small">{{ _('Identifica sesgos usando nuestras herramientas') }}</p>
                            </div>
                        </div>
                        <div class="col-md-4 text-center mb-3">
                            <div class="step-icon">
                                <i class="fas fa-robot fa-2x text-warning mb-2"></i>
                                <h5>{{ _('3. Compara con IA') }}</h5>
                                <p class="text-muted small">{{ _('Ve cómo se compara tu análisis con el de la IA') }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Lista de Textos -->
    <div class="row">
        <div class="col-12">
            <h2 class="text-center mb-4">
                <i class="fas fa-list-alt me-2"></i>
                {{ _('Textos del Desafío') }}
            </h2>
            
            <div class="row">
                {% for text in texts %}
                <div class="col-lg-6 col-xl-4 mb-4">
                    <div class="card h-100 text-card" data-text-id="{{ text.id }}">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h6 class="mb-0 fw-bold">{{ text.title }}</h6>
                            <span class="badge 
                                {% if text.difficulty == 'Fácil' %}bg-success
                                {% elif text.difficulty == 'Medio' %}bg-warning
                                {% else %}bg-danger{% endif %}" 
                                title="{% if text.difficulty == 'Fácil' %}Sesgos evidentes y obvios{% elif text.difficulty == 'Medio' %}Sesgos sutiles pero detectables{% else %}Sesgos muy sutiles o complejos{% endif %}">
                                {{ text.difficulty }}
                            </span>
                        </div>
                        <div class="card-body">
                            <p class="card-text text-muted small">
                                {{ text.text[:150] }}{% if text.text|length > 150 %}...{% endif %}
                            </p>
                            <div class="categories mb-3">
                                {% for category in text.categories %}
                                <span class="badge bg-light text-dark me-1 mb-1">{{ category }}</span>
                                {% endfor %}
                            </div>
                        </div>
                        <div class="card-footer bg-transparent">
                            <button class="btn btn-primary w-100 start-analysis-btn" 
                                    data-text-id="{{ text.id }}">
                                <i class="fas fa-play me-2"></i>
                                {{ _('Comenzar Análisis') }}
                            </button>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Estadísticas del Desafío -->
    <div class="row mt-5">
        <div class="col-12">
            <div class="card border-0 bg-light">
                <div class="card-body text-center py-4">
                    <h4 class="mb-3">{{ _('Estadísticas del Desafío') }}</h4>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="stat-item">
                                <i class="fas fa-file-alt fa-2x text-primary mb-2"></i>
                                <h5>10</h5>
                                <p class="text-muted">{{ _('Textos disponibles') }}</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-item">
                                <i class="fas fa-users fa-2x text-success mb-2"></i>
                                <h5 id="participants-count">0</h5>
                                <p class="text-muted">{{ _('Participantes') }}</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-item">
                                <i class="fas fa-chart-line fa-2x text-warning mb-2"></i>
                                <h5 id="avg-score">0%</h5>
                                <p class="text-muted">{{ _('Puntuación promedio') }}</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-item">
                                <i class="fas fa-trophy fa-2x text-danger mb-2"></i>
                                <h5 id="best-score">0%</h5>
                                <p class="text-muted">{{ _('Mejor puntuación') }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Scientific theme styling */
body {
    background: linear-gradient(135deg, #f8f9ff 0%, #eef2ff 100%);
    min-height: 100vh;
}

.step-icon {
    padding: 1.5rem;
    border-radius: 15px;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
    border: 1px solid rgba(102, 126, 234, 0.2);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.step-icon::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s ease;
}

.step-icon:hover::before {
    left: 100%;
}

.step-icon:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: 0 15px 35px rgba(102, 126, 234, 0.2);
    border-color: rgba(102, 126, 234, 0.4);
}

.step-icon i {
    background: linear-gradient(135deg, #667eea, #764ba2);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.text-card {
    transition: all 0.3s ease;
    border: 1px solid rgba(102, 126, 234, 0.1);
    border-radius: 15px;
    background: white;
    position: relative;
    overflow: hidden;
}

.text-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #667eea, #764ba2, #f093fb, #f5576c, #4facfe);
    background-size: 200% 100%;
    animation: gradientShift 3s ease infinite;
}

@keyframes gradientShift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

.text-card:hover {
    transform: translateY(-10px) scale(1.02);
    box-shadow: 0 20px 40px rgba(102, 126, 234, 0.15);
    border-color: rgba(102, 126, 234, 0.3);
}

.text-card .card-header {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
    border-bottom: 1px solid rgba(102, 126, 234, 0.1);
}

.text-card .badge {
    font-weight: 600;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    border: none;
}

.text-card .badge.bg-success {
    background: linear-gradient(135deg, #28a745, #20c997) !important;
    color: white;
}

.text-card .badge.bg-warning {
    background: linear-gradient(135deg, #ffc107, #fd7e14) !important;
    color: white;
}

.text-card .badge.bg-danger {
    background: linear-gradient(135deg, #dc3545, #e83e8c) !important;
    color: white;
}

.stat-item {
    padding: 1.5rem;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
    border-radius: 15px;
    border: 1px solid rgba(102, 126, 234, 0.1);
    transition: all 0.3s ease;
}

.stat-item:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(102, 126, 234, 0.1);
}

.stat-item i {
    background: linear-gradient(135deg, #667eea, #764ba2);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.categories .badge {
    font-size: 0.75rem;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1)) !important;
    color: #667eea !important;
    border: 1px solid rgba(102, 126, 234, 0.2);
    border-radius: 15px;
    padding: 0.4rem 0.8rem;
}

.start-analysis-btn {
    transition: all 0.3s ease;
    background: linear-gradient(135deg, #667eea, #764ba2) !important;
    border: none;
    border-radius: 25px;
    padding: 0.75rem 1.5rem;
    font-weight: 600;
    position: relative;
    overflow: hidden;
}

.start-analysis-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s ease;
}

.start-analysis-btn:hover::before {
    left: 100%;
}

.start-analysis-btn:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
}

/* Cards styling */
.card {
    border-radius: 15px;
    border: 1px solid rgba(102, 126, 234, 0.1);
    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.08);
}

.card-header {
    border-radius: 15px 15px 0 0 !important;
}

/* Section headers */
h2, h3, h4, h5 {
    background: linear-gradient(135deg, #667eea, #764ba2);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    font-weight: 700;
}

/* Footer styling */
.challenge-footer {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
    border-top: 1px solid rgba(102, 126, 234, 0.1);
}

</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Manejar clics en los botones de análisis
    document.querySelectorAll('.start-analysis-btn').forEach(button => {
        button.addEventListener('click', function() {
            const textId = this.getAttribute('data-text-id');
            window.location.href = `/challenge/analyze/${textId}`;
        });
    });

    // Cargar estadísticas del desafío
    loadChallengeStats();
});

function loadChallengeStats() {
    // Simular carga de estadísticas (en una implementación real, esto vendría de la API)
    document.getElementById('participants-count').textContent = '127';
    document.getElementById('avg-score').textContent = '73%';
    document.getElementById('best-score').textContent = '94%';
}
</script>
{% endblock %}
